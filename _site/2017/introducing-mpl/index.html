<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Introducing MPL: Matrix Processing Language</title>
  <meta name="description" content="In the ocean of code, I swim.">
  <meta name="author" content="Wode "Nimo" Ni">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Wode "Nimo" Ni">
  <meta name="twitter:description" content="In the ocean of code, I swim.">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Wode "Nimo" Ni">
  <meta property="og:description" content="In the ocean of code, I swim.">

  <!--
  <link rel="apple-touch-icon" sizes="57x57" href="images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="images/favicons/manifest.json">
  <link rel="shortcut icon" href="images/favicons/favicon.ico">
  <meta name="msapplication-TileImage" content="images/favicons/mstile-144x144.png">
  -->
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="http://wodeni.github.io/2017/introducing-mpl/">
  <link rel="alternate" type="application/rss+xml" title="Wode "Nimo" Ni" href="feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Wode "Nimo" Ni">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Wode "Nimo" Ni</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">In the ocean of code, I swim.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/about.html" title="link to Wode "Nimo" Ni about" class="about-button">About</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Wode "Nimo" Ni blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/wode-ni" title="wode-ni on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/wodeni" title="wodeni on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:wn2155@columbia.edu" title="Email wn2155@columbia.edu" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            


            <!-- CV -->
            <!-- <li class="navigation__item">
              <a href="https://github.com/wodeni/nimo-resume/raw/master/Nimo_resume.pdf" title="Nimo's CV" target="_blank">
                CV
                <span class="label">CV</span>
              </a>
            </li> -->

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="30 May 2017" class="post-meta__date date">30 May 2017</time> &#8226; <span class="post-meta__tags">on <a href="tags/#PL">PL</a> <a href="tags/#Columbia">Columbia</a> <a href="tags/#OCaml">OCaml</a> </span>
    </div>
    <h1 class="post-title">Introducing MPL: Matrix Processing Language</h1>
  </header>

  <section class="post">
    <p><img src="/images/mpl-logo.png" alt="" class="center-image" /></p>

<p>I know. The name is pretty lame, because we had to come up with a name before we start the project and even learn anything about compilers and programming language design. In retrospect, I would have called it something like “Moore” or “Cell” (okay, probably not good names either <img class="emoji" title=":disappointed:" alt=":disappointed:" src="https://assets.github.com/images/icons/emoji/unicode/1f61e.png" height="20" width="20" align="absmiddle" />).</p>

<p>MPL is a programming language that I, along with 3 other fellow classmates, designed and implemented for COMS 4115 - Programming languages and Translator. It is a Domain Specific Language (DSL), meaning it does not work for everything. Instead, MPL deals with matrices and images. We wanted it to be concise, cool, and reasonable to implement because this is a ~2-month course project.</p>

<p>We designed the language to be light-weight. Something like a scripting language using which we can quickly load images and run image processing operations on them. A simple example is blurring:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">blur</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">sum</span><span class="p">;</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="err">#</span><span class="n">NW</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="err">#</span><span class="n">N</span> <span class="o">+</span> <span class="err">#</span><span class="n">NE</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="err">#</span><span class="n">W</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="err">#</span><span class="n">E</span> <span class="o">+</span> <span class="err">#</span><span class="n">SW</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="err">#</span><span class="n">S</span> <span class="o">+</span> <span class="err">#</span><span class="n">SE</span><span class="p">;</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="err">#</span><span class="n">C</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">sum</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">16</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Mat</span> <span class="n">img</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">pgmread</span><span class="p">(</span><span class="s">"lena.pgm"</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">blur</span> <span class="err">@</span> <span class="n">img</span><span class="p">;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pgmwrite</span><span class="p">(</span><span class="s">"lena-out.pgm"</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p>The program converts the image to the left to the one to the right, as shown here:</p>

<p><img src="/images/2017-05-30-introducing-mpl-73576.png" alt="" class="center-image" /></p>

<p>The one line that does the trick is</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">blur</span> <span class="err">@</span> <span class="n">img</span><span class="p">;</span>
</code></pre>
</div>

<p>We call <code class="highlighter-rouge">@</code> the <strong>apply operator</strong>, read as “apply to”. This line “applies” the <code class="highlighter-rouge">blur</code> function on a matrix, which represents an image. The <code class="highlighter-rouge">blur</code> function is not a normal function you see in C and Java. Instead, like all other MPL functions, <code class="highlighter-rouge">blur</code> is an <strong>entry function</strong>, which can only be “applied” to a matrix.</p>

<p>It turns out that mathematically, the blurring procedure can be modeled as a “convolution” between a kernel and matrix. Inside of <code class="highlighter-rouge">blur</code> is essentially a kernel. See <a href="http://setosa.io/ev/image-kernels/">here</a> for an excellent visual explanation.</p>

<p>In MPL, each entry function has access to its immediate neighbors. This might sound insufficient, but it turns out that local operations on small neighborhood can achieve a great deal! In MPL, we are using 8-neighborhood, also called <a href="https://en.wikipedia.org/wiki/Moore_neighborhood"><strong>Moore Neighborhood</strong></a> (hence the alternative name).</p>

<p>Of course, people have thought about this idea in PLT a long time ago and came up with syntax for convolution. In MPL, we generalized this idea to support conditionals, which is more than convolution (technically, not linear shift invariant).</p>

<p>One day a teammate showed me this epic video of Conway’s game of life. I was amazed by the complexity of the scenes and also the simplicity of the game itself.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/C2vgICfQawE?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>

<p>This turned out to be the final demo. We did a glider gun, which regularly shoots out “gliders”. We resolved edges by wrap-around. That’s why you see the gliders come back to destroy the gun.</p>

<p><img src="/images/gun.gif" alt="" class="center-image" /></p>

<p>Here is a spaceship that we simulated (this thing is quite huge, the console can’t keep up with the refresh rate all the time <img class="emoji" title=":grin:" alt=":grin:" src="https://assets.github.com/images/icons/emoji/unicode/1f601.png" height="20" width="20" align="absmiddle" />):</p>

<p><img src="/images/ship.gif" alt="" class="center-image" /></p>

<p>The language is far from complete due to the time limit and the fact that I was taking OS at the same time (maybe I’ll talk about the pain and gain in that class later). I still like it a lot because we built a complete compiler from scratch, which turned out to be an extremely fun process, and we got some visually pleasing results at the end.</p>

  </section>
  
</article>



      </div>

      <!-- <footer class="footer">
  <span class="footer__copyright">&copy; 2018 Wode "Nimo" Ni. All rights reserved.</span>
</footer> -->

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/javascript" src="/js/main.js"></script>


    </div>
  </body>
</html>
